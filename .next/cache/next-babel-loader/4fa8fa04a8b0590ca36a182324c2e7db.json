{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nvar __jsx = React.createElement;\nimport Head from \"next/head\";\nimport Link from \"next/link\";\nimport AV from \"leancloud-storage\";\nimport dayjs from \"dayjs\";\nimport { useRouter } from \"next/router\";\nimport React, { useState, useEffect } from \"react\";\nimport { Tree, Button, notification, Input, Modal, TreeSelect, Menu, Dropdown, Spin, message } from \"antd\";\nimport styles from \"./index.module.scss\";\nimport Item from \"src/components/www/Comments/item\";\nimport { createComment, getCommentList } from \"src/service/comment\";\nimport { updatePost } from \"src/service/post\"; // const { TextArea } = Input\n\nrequire(\"dayjs/locale/zh-cn\");\n\ndayjs.locale(\"zh-cn\");\n\nvar relativeTime = require(\"dayjs/plugin/relativeTime\");\n\ndayjs.extend(relativeTime);\n\nfunction Components(props) {\n  var _useState = useState(\"\"),\n      content = _useState[0],\n      setcontent = _useState[1];\n\n  var _useState2 = useState(true),\n      disabled = _useState2[0],\n      setdisabled = _useState2[1];\n\n  var _useState3 = useState([]),\n      list = _useState3[0],\n      setlist = _useState3[1];\n\n  var handleSubmit = function handleSubmit() {\n    return _regeneratorRuntime.async(function handleSubmit$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (AV.User.current()) {\n              _context.next = 3;\n              break;\n            }\n\n            message.error(\"请先登录\");\n            return _context.abrupt(\"return\");\n\n          case 3:\n            if (!content) {\n              _context.next = 10;\n              break;\n            }\n\n            _context.next = 6;\n            return _regeneratorRuntime.awrap(createComment(Object.assign({\n              type: props.type,\n              user: props.userinfo,\n              content: content\n            }, props.type === \"article\" ? {\n              aid: props.id\n            } : {\n              pid: props.id\n            })));\n\n          case 6:\n            getlist();\n            setcontent(\"\");\n\n            if (props.type === \"post\") {\n              updatePost({\n                postItem: props.id,\n                params: {\n                  comments: 1\n                }\n              });\n            }\n\n            if (props.type === \"article\") {}\n\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var getlist = function getlist() {\n    var res;\n    return _regeneratorRuntime.async(function getlist$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return _regeneratorRuntime.awrap(getCommentList(Object.assign({\n              type: props.type\n            }, props.type === \"article\" ? {\n              aid: props.id\n            } : {\n              pid: props.id\n            })));\n\n          case 2:\n            res = _context2.sent;\n            setlist(res);\n\n          case 4:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  useEffect(function () {\n    getlist();\n  }, []);\n  useEffect(function () {\n    setdisabled(false);\n  }, [content]);\n  return __jsx(\"div\", {\n    className: styles.comment\n  }, __jsx(\"div\", {\n    className: styles.comment_input\n  }, __jsx(Input, {\n    className: styles.textarea,\n    value: content,\n    placeholder: \"\\u8F93\\u5165\\u8BC4\\u8BBA...\",\n    maxLength: 140,\n    onChange: function onChange(e) {\n      setcontent(e.target.value);\n    }\n  }), __jsx(Button, {\n    type: \"primary\",\n    className: styles.submit,\n    disabled: disabled,\n    onClick: function onClick() {\n      handleSubmit();\n    }\n  }, \"\\u53D1\\u5E03\")), __jsx(\"div\", {\n    className: styles.comment_list\n  }, list.map(function (obj) {\n    return __jsx(Item, {\n      key: obj.id,\n      item: obj,\n      userinfo: props.userinfo\n    });\n  })));\n}\n\nexport default Components;","map":null,"metadata":{},"sourceType":"module"}