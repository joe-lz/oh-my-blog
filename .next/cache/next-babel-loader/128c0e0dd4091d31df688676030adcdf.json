{"ast":null,"code":"var __jsx = React.createElement;\nimport Head from 'next/head';\nimport Link from 'next/link';\nimport AV from 'leancloud-storage';\nimport dayjs from 'dayjs';\nimport { useRouter } from 'next/router';\nimport React, { useState, useEffect } from 'react';\nimport { Tree, Button, notification, Input, Modal, TreeSelect, Menu, Dropdown, Spin, message } from 'antd';\nimport styles from './index.module.scss';\nimport Item from 'src/components/www/Comments/item';\nimport { createComment, getCommentList } from 'src/service/comment';\nimport { updatePost } from 'src/service/post'; // const { TextArea } = Input\n\nrequire('dayjs/locale/zh-cn');\n\ndayjs.locale('zh-cn');\n\nconst relativeTime = require('dayjs/plugin/relativeTime');\n\ndayjs.extend(relativeTime);\n\nfunction Components(props) {\n  const {\n    0: content,\n    1: setcontent\n  } = useState('');\n  const {\n    0: disabled,\n    1: setdisabled\n  } = useState(true);\n  const {\n    0: list,\n    1: setlist\n  } = useState([]);\n\n  const handleSubmit = async () => {\n    if (!AV.User.current()) {\n      message.error('请先登录');\n      return;\n    }\n\n    if (!content) {\n      message.error('请输入评论');\n      return;\n    }\n\n    await createComment(Object.assign({\n      type: props.type,\n      user: props.userinfo,\n      content\n    }, props.type === 'article' ? {\n      aid: props.id\n    } : {\n      pid: props.id\n    }));\n    getlist();\n    setcontent('');\n\n    if (props.type === 'post') {\n      updatePost({\n        postItem: props.id,\n        params: {\n          comments: 1\n        }\n      });\n    }\n\n    if (props.type === 'article') {}\n  };\n\n  const getlist = async () => {\n    const res = await getCommentList(Object.assign({\n      type: props.type\n    }, props.type === 'article' ? {\n      aid: props.id\n    } : {\n      pid: props.id\n    }));\n    setlist(res);\n  };\n\n  useEffect(() => {\n    getlist();\n  }, []);\n  useEffect(() => {\n    setdisabled(false);\n  }, [content]);\n  return __jsx(\"div\", {\n    className: styles.comment\n  }, __jsx(\"div\", {\n    className: styles.comment_input\n  }, __jsx(Input, {\n    className: styles.textarea,\n    value: content,\n    placeholder: \"\\u8F93\\u5165\\u8BC4\\u8BBA...\",\n    maxLength: 140,\n    onChange: e => {\n      setcontent(e.target.value);\n    }\n  }), __jsx(Button, {\n    type: \"primary\",\n    className: styles.submit,\n    disabled: disabled,\n    onClick: () => {\n      handleSubmit();\n    }\n  }, \"\\u53D1\\u5E03\")), __jsx(\"div\", {\n    className: styles.comment_list\n  }, list.map(obj => {\n    return __jsx(Item, {\n      key: obj.id,\n      item: obj,\n      userinfo: props.userinfo\n    });\n  })));\n}\n\nexport default Components;","map":null,"metadata":{},"sourceType":"module"}