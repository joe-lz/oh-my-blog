{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nvar __jsx = React.createElement;\nimport Head from 'next/head';\nimport Link from 'next/link';\nimport AV from 'leancloud-storage';\nimport dayjs from 'dayjs';\nimport { useRouter } from 'next/router';\nimport React, { useState, useEffect } from 'react';\nimport { Tree, Button, notification, Input, Modal, TreeSelect, Menu, Dropdown, Spin } from 'antd';\nimport styles from './index.module.scss';\nimport Upload from 'src/components/www/Upload';\nimport { createPost } from 'src/service/post';\nvar TextArea = Input.TextArea;\n\nfunction Components(props) {\n  var _useState = useState(false),\n      isSpin = _useState[0],\n      setisSpin = _useState[1];\n\n  var _useState2 = useState(false),\n      modalShow = _useState2[0],\n      setmodalShow = _useState2[1];\n\n  var _useState3 = useState(''),\n      desc = _useState3[0],\n      setdesc = _useState3[1];\n\n  var _useState4 = useState(''),\n      imgUrl = _useState4[0],\n      setimgUrl = _useState4[1];\n\n  var _useState5 = useState(null),\n      topic = _useState5[0],\n      settopic = _useState5[1];\n\n  var _useState6 = useState(true),\n      disabled = _useState6[0],\n      setdisabled = _useState6[1];\n\n  var handleSubmit = function handleSubmit() {\n    return _regeneratorRuntime.async(function handleSubmit$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!desc) {\n              _context.next = 10;\n              break;\n            }\n\n            setisSpin(true);\n            _context.next = 4;\n            return _regeneratorRuntime.awrap(createPost({\n              desc: desc,\n              imgUrl: imgUrl,\n              topic: topic ? AV.Object.createWithoutData('CMS_Topics', topic.objectId) : null,\n              userinfo: AV.Object.createWithoutData('CMS_UserInfo', props.userinfo.objectId)\n            }));\n\n          case 4:\n            props.onChange && props.onChange();\n            setisSpin(false);\n            setdesc('');\n            setimgUrl('');\n            settopic(null);\n            setdisabled(true);\n\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var menu = __jsx(Menu, null, props.topiclist.map(function (obj) {\n    return __jsx(Menu.Item, {\n      key: obj.objectId\n    }, __jsx(\"div\", {\n      className: styles.topic_item,\n      onClick: function onClick() {\n        settopic(obj);\n      }\n    }, __jsx(\"div\", {\n      className: styles.topic_item_img,\n      style: {\n        backgroundImage: \"url(\".concat(obj.url, \")\")\n      }\n    }), obj.title));\n  }));\n\n  useEffect(function () {}, []);\n  useEffect(function () {\n    if (desc) {\n      setdisabled(false);\n    } else {\n      setdisabled(true);\n    }\n  }, [desc]);\n  return __jsx(Spin, {\n    spinning: isSpin,\n    tip: \"\\u52A0\\u8F7D\\u4E2D...\"\n  }, __jsx(\"div\", {\n    className: styles.postEditor\n  }, __jsx(\"div\", {\n    className: styles.input\n  }, __jsx(TextArea, {\n    autoSize: true,\n    className: styles.textarea,\n    value: desc,\n    placeholder: \"\\u544A\\u8BC9\\u4F60\\u4E2A\\u5C0F\\u79D8\\u5BC6\\uFF0C\\u6DFB\\u52A0\\u5408\\u9002\\u8BDD\\u9898\\u4F1A\\u88AB\\u66F4\\u591A\\u4EBA\\u770B\\u89C1\\u54DF\\uFF5E\",\n    maxLength: 140,\n    onChange: function onChange(e) {\n      setdesc(e.target.value);\n    }\n  }), __jsx(\"div\", {\n    className: styles.postEditor_media\n  }, imgUrl && __jsx(\"div\", {\n    className: styles.postEditor_media_img\n  }, __jsx(\"i\", {\n    className: \"iconfont icon-close\",\n    onClick: function onClick() {\n      setimgUrl('');\n    }\n  }), __jsx(\"div\", {\n    className: styles.postEditor_media_img_content,\n    style: {\n      backgroundImage: \"url(\".concat(imgUrl, \")\")\n    },\n    onClick: function onClick() {\n      setmodalShow(true);\n    }\n  })), topic && __jsx(\"div\", {\n    className: styles.postEditor_media_topic\n  }, topic.title))), __jsx(\"div\", {\n    className: styles.postEditor_operation\n  }, __jsx(\"div\", {\n    className: styles.postEditor_operation_btn,\n    onClick: function onClick() {\n      setmodalShow(true);\n    }\n  }, __jsx(\"i\", {\n    className: \"iconfont icon-tupian1\",\n    style: {\n      marginRight: 5\n    }\n  }), \"\\u56FE\\u7247\"), __jsx(Dropdown, {\n    overlay: menu,\n    arrow: true,\n    placement: \"bottomCenter\"\n  }, __jsx(\"div\", {\n    className: styles.postEditor_operation_btn\n  }, __jsx(\"i\", {\n    className: \"iconfont icon-huatifuhao\"\n  }), \"\\u8BDD\\u9898\")), __jsx(Button, {\n    type: \"primary\",\n    className: styles.submit,\n    disabled: disabled,\n    onClick: function onClick() {\n      handleSubmit();\n    }\n  }, \"\\u53D1\\u5E03\")), __jsx(Modal, {\n    width: 900,\n    visible: modalShow,\n    onCancel: function onCancel() {\n      setmodalShow(false);\n    },\n    onOk: function onOk() {},\n    okText: \"\\u4FDD\\u5B58\",\n    cancelText: \"\\u53D6\\u6D88\",\n    bodyStyle: {\n      padding: 0\n    },\n    footer: null\n  }, modalShow && __jsx(Upload, {\n    onChoose: function _callee(_ref) {\n      var url;\n      return _regeneratorRuntime.async(function _callee$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              url = _ref.url;\n              setmodalShow(false);\n              setimgUrl(url);\n\n            case 3:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }\n  }))));\n}\n\nexport default Components;","map":null,"metadata":{},"sourceType":"module"}