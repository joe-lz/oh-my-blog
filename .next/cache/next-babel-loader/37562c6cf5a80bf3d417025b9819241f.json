{"ast":null,"code":"var __jsx = React.createElement;\nimport Head from 'next/head';\nimport Link from 'next/link';\nimport AV from 'leancloud-storage';\nimport dayjs from 'dayjs';\nimport { useRouter } from 'next/router';\nimport React, { useState, useEffect } from 'react';\nimport { Button, message } from 'antd';\nimport styles from './index.module.scss';\nimport { userFollow, userUnFollow, userFolloweeList } from 'src/service/user';\nComponents.defaultProps = {\n  followeeList: [],\n  userinfo: null,\n  time: null,\n  views: 0\n};\n\nfunction Components(props) {\n  const userinfoNew = JSON.parse(JSON.stringify(props.userinfo)); // const [followeeList, setfolloweeList] = useState([])\n\n  const {\n    0: isFollowing,\n    1: setisFollowing\n  } = useState(false); // const handleFetchFollowee = async () => {\n  //   const list = await userFolloweeList()\n  //   if (list) {\n  //     setfolloweeList(JSON.parse(JSON.stringify(list)))\n  //     localStorage.setItem('My_CMS_FolloweeList', JSON.stringify(list))\n  //     localStorage.setItem('My_CMS_FolloweeList_time', Date.now())\n  //   }\n  // }\n\n  useEffect(() => {// const fetchData = async () => {\n    //   if (\n    //     localStorage.getItem('My_CMS_FolloweeList') &&\n    //     Number(localStorage.getItem('My_CMS_FolloweeList_time')) + 5 * 60 * 1000 > Date.now()\n    //   ) {\n    //     const list = JSON.parse(localStorage.getItem('My_CMS_FolloweeList'))\n    //     setfolloweeList(list)\n    //   } else {\n    //     handleFetchFollowee()\n    //   }\n    // }\n    // fetchData()\n  }, []);\n  useEffect(() => {\n    props.followeeList.map(obj => {\n      if (obj.objectId === userinfoNew.user.objectId) {\n        setisFollowing(true);\n      }\n    });\n  }, [props.followeeList]);\n  return __jsx(React.Fragment, null, props.userinfo && __jsx(\"div\", {\n    className: styles.userinfo\n  }, __jsx(\"a\", {\n    href: `/www/user/${userinfoNew.objectId}`,\n    target: \"_blank\",\n    style: {\n      display: 'block'\n    }\n  }, __jsx(\"div\", {\n    className: styles.userinfo_content\n  }, __jsx(\"div\", {\n    className: styles.avatar,\n    style: {\n      backgroundImage: `url(${userinfoNew.avatar})`\n    }\n  }), __jsx(\"div\", {\n    className: styles.userinfo_info\n  }, __jsx(\"p\", {\n    className: styles.nickname\n  }, userinfoNew.nickname), __jsx(\"p\", {\n    className: styles.about\n  }, userinfoNew.position, userinfoNew.co_name ? `@${userinfoNew.co_name}` : '', userinfoNew.position || userinfoNew.co_name ? '・' : '', props.time ? `${props.time}` : '', props.views ? `・阅读 ${props.views}` : '')))), __jsx(\"div\", {\n    className: styles.userinfo_follow\n  }, !isFollowing && __jsx(Button // type='primary'\n  , {\n    size: \"small\" // disabled={isFollowing}\n    ,\n    onClick: async () => {\n      if (isFollowing) {\n        userUnFollow({\n          userid: userinfoNew.user.objectId\n        }).then(() => {\n          message.success('取消关注成功');\n          setisFollowing(false);\n        }).catch(err => {\n          message.error(err);\n        });\n      } else {\n        userFollow({\n          userid: userinfoNew.user.objectId\n        }).then(() => {\n          message.success('关注成功');\n          setisFollowing(true);\n        }).catch(err => {\n          message.error(err);\n        });\n      }\n    }\n  }, isFollowing ? '已关注' : '关注'))));\n}\n\nexport default Components;","map":null,"metadata":{},"sourceType":"module"}