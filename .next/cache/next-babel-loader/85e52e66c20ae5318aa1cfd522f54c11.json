{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport Head from 'next/head';\nimport AV from 'leancloud-storage';\nimport dynamic from 'next/dynamic';\nimport React, { useState, useEffect } from 'react';\nimport { Tree, Button, notification, Input, Modal, TreeSelect } from 'antd';\nimport { useRouter } from 'next/router';\nimport marked from 'marked';\nimport hljs from 'highlight.js';\nvar CodeMirror = null;\n\nif (true && typeof window.navigator !== 'undefined') {\n  var _require = require('react-codemirror2'),\n      UnControlled = _require.UnControlled;\n\n  CodeMirror = UnControlled;\n\n  require('codemirror/mode/javascript/javascript'); // require('codemirror/mode/markdown/markdown')\n\n}\n\nimport styles from './index.module.scss';\nimport Layout from 'src/components/admin/Layout';\nimport { getMenusList } from 'src/service/menu';\nimport { getArticleById, updateArticle } from 'src/service/article';\nvar TextArea = Input.TextArea;\nvar renderer = new marked.Renderer();\nmarked.setOptions({\n  renderer: renderer,\n  highlight: function highlight(code, language) {\n    var hljs = require('highlight.js');\n\n    var validLanguage = hljs.getLanguage(language) ? language : 'plaintext';\n    return hljs.highlight(validLanguage, code).value;\n  },\n  pedantic: false,\n  gfm: true,\n  breaks: false,\n  sanitize: false,\n  smartLists: true,\n  smartypants: false,\n  xhtml: false\n});\n\nfunction AdminHome() {\n  var router = useRouter();\n  var aid = router.query.aid;\n\n  var _useState = useState(null),\n      articleItem = _useState[0],\n      setarticleItem = _useState[1];\n\n  var _useState2 = useState([]),\n      menus = _useState2[0],\n      setmenus = _useState2[1];\n\n  var _useState3 = useState(null),\n      category_1_key = _useState3[0],\n      setcategory_1_key = _useState3[1];\n\n  var _useState4 = useState(null),\n      category_1_title = _useState4[0],\n      setcategory_1_title = _useState4[1];\n\n  var _useState5 = useState(null),\n      category_2_key = _useState5[0],\n      setcategory_2_key = _useState5[1];\n\n  var _useState6 = useState(null),\n      category_2_title = _useState6[0],\n      setcategory_2_title = _useState6[1];\n\n  var _useState7 = useState(''),\n      articleTitle = _useState7[0],\n      setarticleTitle = _useState7[1];\n\n  var _useState8 = useState(\"\\nMarked - Markdown Parser\\n========================\\n\\n[Marked] lets you convert [Markdown] into HTML.  Markdown is a simple text format whose goal is to be very easy to read and write, even when not converted to HTML.  This demo page will let you type anything you like and see how it gets converted.  Live.  No more waiting around.\\n\\nHow To Use The Demo\\n-------------------\\n\\n1. Type in stuff on the left.\\n2. See the live updates on the right.\\n\\nThat's it.  Pretty simple.  There's also a drop-down option in the upper right to switch between various views:\\n\\n- **Preview:**  A live display of the generated HTML as it would render in a browser.\\n- **HTML Source:**  The generated HTML before your browser makes it pretty.\\n- **Lexer Data:**  What [marked] uses internally, in case you like gory stuff like this.\\n- **Quick Reference:**  A brief run-down of how to format things using markdown.\\n\\nWhy Markdown?\\n-------------\\n\\nIt's easy.  It's not overly bloated, unlike HTML.  Also, as the creator of [markdown] says,\\n\\n> The overriding design goal for Markdown's\\n> formatting syntax is to make it as readable\\n> as possible. The idea is that a\\n> Markdown-formatted document should be\\n> publishable as-is, as plain text, without\\n> looking like it's been marked up with tags\\n> or formatting instructions.\\n\\nReady to start writing?  Either start changing stuff on the left or\\n[clear everything](/demo/?text=) with a simple click.\\n\\n[Marked]: https://github.com/markedjs/marked/\\n[Markdown]: http://daringfireball.net/projects/markdown/\\n\"),\n      articleVal = _useState8[0],\n      setarticleVal = _useState8[1];\n\n  var handleGetMenu = function handleGetMenu() {\n    var res;\n    return _regeneratorRuntime.async(function handleGetMenu$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(getMenusList());\n\n          case 2:\n            res = _context.sent;\n            setmenus(res.toJSON().value);\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var onCategoryChange = function onCategoryChange(selectKey) {\n    var category_1_key = null;\n    var category_1_title = null;\n    var category_2_key = null;\n    var category_2_title = null;\n    menus.map(function (obj1) {\n      if (obj1.key === selectKey) {\n        category_1_key = obj1.key;\n        category_1_title = obj1.title;\n      }\n\n      if (obj1.children) {\n        obj1.children.map(function (obj2) {\n          if (obj2.key === selectKey) {\n            category_1_key = obj1.key;\n            category_1_title = obj1.title;\n            category_2_key = obj2.key;\n            category_2_title = obj2.title;\n          }\n\n          return obj2;\n        });\n      }\n\n      return obj1;\n    });\n    setcategory_1_key(category_1_key);\n    setcategory_1_title(category_1_title);\n    setcategory_2_key(category_2_key);\n    setcategory_2_title(category_2_title);\n  };\n\n  var handleUpdate = function handleUpdate() {\n    var params,\n        _args2 = arguments;\n    return _regeneratorRuntime.async(function handleUpdate$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            params = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : {};\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(updateArticle({\n              articleItem: articleItem,\n              params: _objectSpread({\n                articleVal: articleVal,\n                title: articleTitle,\n                category_1_key: category_1_key,\n                category_1_title: category_1_title,\n                category_2_key: category_2_key,\n                category_2_title: category_2_title\n              }, params)\n            }));\n\n          case 3:\n            notification.success({\n              message: '保存成功' // description: \"请输入用户名、密码\",\n\n            });\n\n          case 4:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  useEffect(function () {\n    handleGetMenu();\n  }, []);\n  useEffect(function () {\n    if (router && router.query) {\n      if (aid) {\n        var fetchData = function fetchData() {\n          var res, articleItem;\n          return _regeneratorRuntime.async(function fetchData$(_context3) {\n            while (1) {\n              switch (_context3.prev = _context3.next) {\n                case 0:\n                  _context3.next = 2;\n                  return _regeneratorRuntime.awrap(getArticleById({\n                    id: aid\n                  }));\n\n                case 2:\n                  res = _context3.sent;\n                  articleItem = res.toJSON();\n                  setcategory_1_key(articleItem.category_1_key);\n                  setcategory_1_title(articleItem.category_1_title);\n                  setcategory_2_key(articleItem.category_2_key);\n                  setcategory_2_title(articleItem.category_2_title);\n\n                  try {\n                    setarticleItem(res);\n                    setarticleTitle(articleItem.title);\n                  } catch (error) {\n                    console.log(error);\n                  }\n\n                  if (articleItem.articleVal) {\n                    setarticleVal(articleItem.articleVal);\n                  }\n\n                case 10:\n                case \"end\":\n                  return _context3.stop();\n              }\n            }\n          }, null, null, null, Promise);\n        };\n\n        fetchData();\n      }\n    }\n  }, [router]);\n  return __jsx(Layout, {\n    hideSidebar: true,\n    bodyStyle: {\n      paddingBottom: 0\n    }\n  }, articleItem && __jsx(\"div\", {\n    className: styles.articles_detail\n  }, __jsx(\"div\", {\n    className: styles.articles_detail_title\n  }, __jsx(\"div\", {\n    className: styles.articles_detail_title_body\n  }, __jsx(\"p\", {\n    className: styles.articles_detail_title_label\n  }, \"\\u6807\\u9898\\uFF1A\"), __jsx(\"input\", {\n    className: styles.articles_detail_title_input,\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u6587\\u7AE0\\u6807\\u9898\",\n    value: articleTitle,\n    onChange: function onChange(e) {\n      setarticleTitle(e.target.value);\n    }\n  }), __jsx(\"div\", {\n    className: styles.articles_detail_operation\n  }, __jsx(\"div\", {\n    className: styles.articles_detail_operation_btn\n  }, __jsx(TreeSelect, {\n    style: {\n      width: '100%'\n    },\n    value: category_2_key || category_1_key,\n    dropdownStyle: {\n      maxHeight: 400,\n      overflow: 'auto'\n    },\n    treeData: menus,\n    placeholder: \"\\u8BF7\\u9009\\u62E9\\u5206\\u7C7B\",\n    treeDefaultExpandAll: true,\n    onChange: function onChange(catgory_key) {\n      onCategoryChange(catgory_key);\n    }\n  })), __jsx(Button, {\n    type: \"primary\",\n    size: \"large\",\n    shape: \"round\",\n    onClick: function _callee() {\n      return _regeneratorRuntime.async(function _callee$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return _regeneratorRuntime.awrap(handleUpdate());\n\n            case 2:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }\n  }, \"\\u4FDD\\u5B58\"), __jsx(Button, {\n    type: \"primary\",\n    size: \"large\",\n    shape: \"round\",\n    danger: true,\n    onClick: function _callee2() {\n      return _regeneratorRuntime.async(function _callee2$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return _regeneratorRuntime.awrap(handleUpdate({\n                status: 3\n              }));\n\n            case 2:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }\n  }, \"\\u4FDD\\u5B58\\u5E76\\u4E0A\\u7EBF\")))), __jsx(\"div\", {\n    className: styles.articles_detail_body\n  }, __jsx(\"div\", {\n    className: styles.articles_detail_left\n  }, CodeMirror && __jsx(CodeMirror, {\n    value: articleVal,\n    options: {\n      mode: 'javascript',\n      theme: 'github-light',\n      lineNumbers: true\n    },\n    onChange: function onChange(editor, data, value) {\n      setarticleVal(value);\n    }\n  })), __jsx(\"div\", {\n    className: styles.articles_detail_right\n  }, __jsx(\"article\", {\n    className: \"markdown-body\",\n    dangerouslySetInnerHTML: {\n      __html: marked(articleVal)\n    }\n  })))));\n}\n\nexport default AdminHome;","map":null,"metadata":{},"sourceType":"module"}