{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nvar __jsx = React.createElement;\nimport Head from \"next/head\";\nimport Link from \"next/link\";\nimport AV from \"leancloud-storage\";\nimport dayjs from \"dayjs\";\nimport React, { useState, useEffect } from \"react\";\nimport { getMenusList } from \"src/service/menu\";\nimport { getProfileList, updateProfile } from \"src/service/profile\";\nimport { getMyUserInfo, createUserInfo } from \"src/service/user\";\nimport styles from \"./index.module.scss\";\nimport Nav from \"../Nav\";\nComponents.defaultProps = {\n  onChange: function onChange() {}\n};\n\nfunction Components(props) {\n  var _useState = useState(null),\n      menus = _useState[0],\n      setmenus = _useState[1];\n\n  var _useState2 = useState(null),\n      profile = _useState2[0],\n      setprofile = _useState2[1];\n\n  var _useState3 = useState(null),\n      curUserInfo = _useState3[0],\n      setcurUserInfo = _useState3[1];\n\n  var handleInit = function handleInit() {\n    return _regeneratorRuntime.async(function handleInit$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(getData(\"CMS_Menus\", getMenusList, setmenus));\n\n          case 3:\n            _context.next = 5;\n            return _regeneratorRuntime.awrap(getData(\"CMS_Profile\", getProfileList, setprofile));\n\n          case 5:\n            _context.next = 7;\n            return _regeneratorRuntime.awrap(getData(\"CMS_UserInfo\", getMyUserInfo, setcurUserInfo));\n\n          case 7:\n            _context.next = 12;\n            break;\n\n          case 9:\n            _context.prev = 9;\n            _context.t0 = _context[\"catch\"](0);\n            console.error(_context.t0);\n\n          case 12:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 9]], Promise);\n  };\n\n  var getData = function getData(keyname, func, setFunc) {\n    var local_data, res;\n    return _regeneratorRuntime.async(function getData$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            // 获取菜单\n            local_data = sessionStorage.getItem(keyname);\n\n            if (!local_data) {\n              _context2.next = 6;\n              break;\n            }\n\n            setFunc(JSON.parse(local_data));\n\n            if (keyname === \"CMS_Profile\") {\n              updateViews({\n                profile_id: JSON.parse(local_data).objectId\n              });\n            }\n\n            _context2.next = 20;\n            break;\n\n          case 6:\n            _context2.next = 8;\n            return _regeneratorRuntime.awrap(func());\n\n          case 8:\n            res = _context2.sent;\n\n            if (!res) {\n              _context2.next = 15;\n              break;\n            }\n\n            setFunc(JSON.parse(JSON.stringify(res)));\n            sessionStorage.setItem(keyname, JSON.stringify(res));\n\n            if (keyname === \"CMS_Profile\") {\n              updateViews({\n                profile_id: JSON.parse(JSON.stringify(res)).objectId\n              });\n              updateViews_UV({\n                profile_id: JSON.parse(JSON.stringify(res)).objectId\n              });\n            }\n\n            _context2.next = 20;\n            break;\n\n          case 15:\n            if (!(keyname === \"CMS_UserInfo\" && AV.User.current())) {\n              _context2.next = 20;\n              break;\n            }\n\n            _context2.next = 18;\n            return _regeneratorRuntime.awrap(createUserInfo());\n\n          case 18:\n            _context2.next = 20;\n            return _regeneratorRuntime.awrap(getData(\"CMS_UserInfo\", getMyUserInfo, setcurUserInfo));\n\n          case 20:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }; // 更新views\n\n\n  var updateViews = function updateViews(_ref) {\n    var profile_id = _ref.profile_id;\n    updateProfile({\n      profileItem: AV.Object.createWithoutData(\"CMS_Profile\", profile_id),\n      params: {\n        views: 1\n      }\n    });\n  };\n\n  var updateViews_UV = function updateViews_UV(_ref2) {\n    var profile_id = _ref2.profile_id;\n    // 更新views\n    updateProfile({\n      profileItem: AV.Object.createWithoutData(\"CMS_Profile\", profile_id),\n      params: {\n        views_uv: 1\n      }\n    });\n  };\n\n  useEffect(function () {\n    handleInit();\n  }, []);\n  useEffect(function () {\n    props.onChange && props.onChange({\n      menus: menus,\n      profile: profile,\n      userinfo: curUserInfo\n    });\n  }, [menus, profile, curUserInfo]);\n  return __jsx(\"div\", {\n    className: styles.container\n  }, menus && profile && __jsx(Nav, {\n    menus: menus.value,\n    profile: profile,\n    userinfo: curUserInfo\n  }), __jsx(\"div\", {\n    className: styles.body\n  }, props.children), profile && __jsx(\"footer\", {\n    className: styles.footer\n  }, __jsx(\"div\", {\n    className: styles.footer_content\n  }, __jsx(\"div\", {\n    className: styles.logo // style={{ backgroundImage: `url(${profile.logo})` }}\n\n  }, __jsx(\"img\", {\n    src: profile.logo,\n    alt: \"\",\n    className: \"logo\"\n  })), profile.github && __jsx(\"div\", {\n    className: styles.item\n  }, \"github\\uFF1A\", __jsx(\"a\", {\n    href: profile.github,\n    className: \"link\",\n    target: \"_blank\"\n  }, profile.github)), profile.email && __jsx(\"div\", {\n    className: styles.item\n  }, \"\\u90AE\\u7BB1\\uFF1A\", __jsx(\"a\", {\n    href: \"mailto:\".concat(profile.email),\n    className: \"link\"\n  }, profile.email)), profile.copyright && __jsx(\"div\", {\n    className: styles.copyright\n  }, profile.copyright), __jsx(\"div\", {\n    className: styles.copyright\n  }, \"\\u5F53\\u524D\\u7AD9\\u70B9\\u603B\\u8BBF\\u95EE\\u91CF \".concat(profile.views || \"...\", \" \\u6B21\\uFF0C\\u603B\\u8BBF\\u5BA2\\u6570 \").concat(profile.views_uv || \"...\", \" \\u4EBA\")))));\n}\n\nexport default Components;","map":null,"metadata":{},"sourceType":"module"}